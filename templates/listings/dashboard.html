{% extends "base.html" %}

{% block content %}
<h1>My Listings & Bookings Dashboard</h1>
<hr>
<p><a href="{% url 'listings:create' %}">+ Create a New Listing</a></p>
<hr>

{% for listing in listings %}
    <div style="margin-bottom: 30px;">
        <h3>Listing: <a href="{{ listing.get_absolute_url }}">{{ listing.title }}</a></h3>
        
        <h4>Booking Requests for this Listing:</h4>
        {% with bookings=listing.bookings.all %}
            {% if bookings %}
                <ul>
                    {% for booking in bookings %}
                    <li>
                        Request from: <strong>{{ booking.requester.username }}</strong>
                        | Status: <strong>{{ booking.get_status_display }}</strong>
                        
                        {% if booking.status == 'PENDING' %}
                        <form action="{% url 'bookings:update_status' booking.pk 'APPROVED' %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit">Approve</button>
                        </form>
                        <form action="{% url 'bookings:update_status' booking.pk 'DENIED' %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit">Deny</button>
                        </form>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No booking requests for this listing yet.</p>
            {% endif %}
        {% endwith %}
    </div>
{% empty %}
    <p>You have not created any listings yet.</p>
{% endfor %}
{% endblock content %}