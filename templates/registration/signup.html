{% extends "base.html" %}
{% load static %}
{% load socialaccount %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sign Up – Samaya Spaces</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #1f1f29;
      --muted: #6b6f76;
      --primary: #5b3df5;
      --primary-700: #4a2fe6;
      --ring: #e7e8ee;
      --shadow: 0 10px 30px rgba(12, 18, 38, .12);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { background: var(--bg); color: var(--text); font: 15px/1.4 system-ui, sans-serif; }

    .wrap { min-height: calc(100vh - 1px); display: flex; align-items: center; justify-content: center; }
    .card {
      width: 100%; max-width: 1000px; height: 90vh;
      background: var(--card); box-shadow: var(--shadow);
      display: grid; grid-template-columns: 1fr 0.9fr;
      overflow: hidden; border-radius: 16px;
    }
    .media {
      background:
        linear-gradient(0deg, rgba(0,0,0,.18), rgba(0,0,0,.18)),
        url("https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1600&auto=format&fit=crop");
      background-size: cover; background-position: center;
    }
    .panel { padding: 24px 32px; display: flex; flex-direction: column; justify-content: center; gap: 12px; overflow-y: auto; }
    h1 { font-size: 28px; margin: 0; }
    .sub { color: var(--muted); margin-bottom: 6px; font-size: 14px; }

    /* form */
    form { display: grid; grid-template-columns: 1fr 1fr; gap: 12px 14px; margin-top: 4px; }
    .full { grid-column: 1 / -1; }
    label { font-weight: 600; font-size: 13px; margin-bottom: 4px; display: block; }
    input {
      width: 100%; height: 38px; border: 1px solid var(--ring); border-radius: 8px;
      padding: 6px 10px; font-size: 14px; background: #fff; outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(91,61,245,.2); }

    .hint { margin-top: 3px; color: var(--muted); font-size: 12px; line-height: 1.3; }
    .hint ul { margin: 4px 0 0 16px; padding: 0; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      height: 42px; padding: 0 14px; border-radius: 999px; border: none;
      background: var(--primary); color: #fff; font-weight: 600; font-size: 14px;
      cursor: pointer; box-shadow: 0 6px 16px rgba(91,61,245,.25);
      transition: transform .06s ease, background .15s ease;
    }
    .btn:hover { background: var(--primary-700); }
    .btn:active { transform: translateY(1px); }

    .foot { margin-top: 4px; font-size: 13px; color: var(--muted); }

    /* Error styles */
    .err { color: #b42318; font-size: 12px; margin-top: 4px; }
    .field-error { border-color: #b42318 !important; box-shadow: 0 0 0 2px rgba(180,35,24,.15) !important; }
    .non-field-errors { grid-column: 1 / -1; padding: 10px 12px; border-radius: 8px; background: #fff3f2; color: #8a1f16; font-size: 13px; }

    /* Compact Google button */
    .oauth--sm { margin: 6px 0 10px; display: flex; justify-content: flex-start; }
    .btn-google--sm {
      width: auto; height: 36px; padding: 0 12px;
      border-radius: 8px; border: 1px solid #dadce0;
      background: #fff; color: #1f1f29; font-weight: 600; font-size: 13px;
      display: inline-flex; align-items: center; gap: 8px;
      text-decoration: none; box-shadow: 0 1px 2px rgba(0,0,0,.04);
      transition: background .15s ease, box-shadow .15s ease;
    }
    .btn-google--sm:hover { background: #f7f8fa; box-shadow: 0 2px 5px rgba(0,0,0,.06); }
    .btn-google--sm svg { width: 16px; height: 16px; display: block; }

    @media (max-width: 900px) {
      .card { grid-template-columns: 1fr; height: auto; }
      .media { display: none; }
      .panel { padding: 20px; }
      form { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="media" aria-hidden="true"></div>

    <div class="panel">
      <h1>Sign Up</h1>
      <p class="sub">Create your account to find the perfect student space—rent without brokers.</p>

      {% if form.non_field_errors %}
        <div class="non-field-errors">
          {% for err in form.non_field_errors %}• {{ err }}<br>{% endfor %}
        </div>
      {% endif %}

      <!-- Compact Google Sign-in -->
      <div class="oauth--sm full">
        <a class="btn-google--sm"
           href="{% provider_login_url 'google' process='login' %}?next=/">
          <!-- Google “G” SVG -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" aria-hidden="true">
            <path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303C33.826 31.91 29.318 35 24 35 16.82 35 11 29.18 11 22S16.82 9 24 9c3.59 0 6.84 1.35 9.31 3.56l5.65-5.65C35.9 3.02 30.24 1 24 1 10.75 1 0 11.75 0 25s10.75 24 24 24 24-10.75 24-24c0-1.62-.17-3.2-.389-4.917z"/>
            <path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.57 16.1 19.02 13 24 13c3.59 0 6.84 1.35 9.31 3.56l5.65-5.65C35.9 3.02 30.24 1 24 1 14.87 1 6.93 6.16 2.69 14.03l3.616 2.661z"/>
            <path fill="#4CAF50" d="M24 49c6.1 0 11.68-2.34 15.84-6.16l-7.31-5.99C30.21 38.49 27.27 39.5 24 39.5c-5.29 0-9.81-3.61-11.41-8.47l-6.57 5.06C9.35 42.84 16.17 49 24 49z"/>
            <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-1.03 3.06-3.26 5.49-6.17 6.85l.004-.003 7.31 5.99C39.41 38.98 48 33 48 25c0-1.62-.17-3.2-.389-4.917z"/>
          </svg>
          Sign in with Google
        </a>
      </div>

      <form id="signupForm" method="post" action="" novalidate>
        {% csrf_token %}

        <!-- Username -->
        <div class="full">
          <label for="id_username">Username:</label>
          <input
            id="id_username"
            name="{{ form.username.name|default:'username' }}"
            type="text"
            value="{{ form.username.value|default_if_none:'' }}"
            required pattern="[A-Za-z0-9@.+_\-]{1,150}" maxlength="150"
            placeholder="your_username"
            class="{% if form.username.errors %}field-error{% endif %}"
            autocomplete="username"
          />
          <p class="hint">Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.</p>
          {% if form.username.errors %}<div class="err">{{ form.username.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- First & Last name -->
        <div>
          <label for="id_first_name">First name:</label>
          <input
            id="id_first_name"
            name="{{ form.first_name.name|default:'first_name' }}"
            type="text"
            value="{{ form.first_name.value|default_if_none:'' }}"
            class="{% if form.first_name.errors %}field-error{% endif %}"
            autocomplete="given-name"
          />
          {% if form.first_name.errors %}<div class="err">{{ form.first_name.errors|join:', ' }}</div>{% endif %}
        </div>

        <div>
          <label for="id_last_name">Last name:</label>
          <input
            id="id_last_name"
            name="{{ form.last_name.name|default:'last_name' }}"
            type="text"
            value="{{ form.last_name.value|default_if_none:'' }}"
            class="{% if form.last_name.errors %}field-error{% endif %}"
            autocomplete="family-name"
          />
          {% if form.last_name.errors %}<div class="err">{{ form.last_name.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- Email -->
        <div class="full">
          <label for="id_email">Email address:</label>
          <input
            id="id_email"
            name="{{ form.email.name|default:'email' }}"
            type="email"
            value="{{ form.email.value|default_if_none:'' }}"
            class="{% if form.email.errors %}field-error{% endif %}"
            placeholder="you@example.com"
            autocomplete="email"
          />
          {% if form.email.errors %}<div class="err">{{ form.email.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- Phone -->
        <div class="full">
          <label for="id_phone">Phone number:</label>
          <input
            id="id_phone"
            name="{{ form.phone.name|default:'phone' }}"
            type="tel"
            value="{{ form.phone.value|default_if_none:'' }}"
            class="{% if form.phone.errors %}field-error{% endif %}"
            placeholder="+9779847352926"
            pattern="^\+\d{10,15}$"
            autocomplete="tel"
          />
          <p class="hint">Enter phone number in format: +9779847352926</p>
          {% if form.phone.errors %}<div class="err">{{ form.phone.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- Password -->
        <div class="full">
          <label for="id_password1">Password:</label>
          <input
            id="id_password1"
            name="{{ form.password1.name|default:'password1' }}"
            type="password"
            class="{% if form.password1.errors %}field-error{% endif %}"
            minlength="8"
            autocomplete="new-password"
            required
          />
          <div class="hint">
            <ul>
              <li>Your password can’t be too similar to your other personal information.</li>
              <li>Your password must contain at least 8 characters.</li>
              <li>Your password can’t be a commonly used password.</li>
              <li>Your password can’t be entirely numeric.</li>
            </ul>
          </div>
          {% if form.password1.errors %}<div class="err">{{ form.password1.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- Password confirmation -->
        <div class="full">
          <label for="id_password2">Password confirmation:</label>
          <input
            id="id_password2"
            name="{{ form.password2.name|default:'password2' }}"
            type="password"
            class="{% if form.password2.errors %}field-error{% endif %}"
            autocomplete="new-password"
            required
          />
          <p class="hint">Enter the same password as before, for verification.</p>
          <div id="pwError" class="err" style="display:none">Passwords don’t match. Please re-enter.</div>
          {% if form.password2.errors %}<div class="err">{{ form.password2.errors|join:', ' }}</div>{% endif %}
        </div>

        <!-- Submit -->
        <div class="full">
          <button class="btn" type="submit">Sign Up</button>
        </div>
      </form>

      <p class="foot">Already have an account? <a href="{% url 'login' %}">Log in</a></p>
    </div>
  </div>
</div>

<script>
  (function() {
    const form = document.getElementById('signupForm');
    const pw1 = document.getElementById('id_password1');
    const pw2 = document.getElementById('id_password2');
    const pwError = document.getElementById('pwError');

    form.addEventListener('submit', function(e) {
      pwError.style.display = 'none';
      if (pw1.value !== pw2.value) {
        e.preventDefault();
        pwError.style.display = 'block';
        pw2.focus();
      }
    });
  })();
</script>
</body>
</html>
{% endblock content %}
